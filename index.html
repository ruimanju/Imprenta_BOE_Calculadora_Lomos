<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de grosor de lomo</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 14px;
            font-size: 1em;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            text-align: center;
            font-size: 1.35em;
        }

        .calculator {
            width: 340px;
            margin: 0 auto;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 3.5px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        select,
        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        
        /* Contenedor para el campo de grosor personalizado */
        .custom-grosor-container {
            display: none; /* Oculto por defecto */
            margin-top: -5px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
			font-size: 1em; /* Ajusta el tamaño del texto */
			font-weight: bold; /* Pone el texto en negrita */
        }

        #result {
            margin-top: 10px;
            font-weight: bold;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .logo {
            max-width: 480px;
            height: auto;
        }

        .advertencia {
            color: red;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e6ed;
            color: #7f8c8d;
            font-size: 1rem;
        }

        /* --- Estilos para la tabla del catálogo --- */
        #toggle-table-btn {
            width: 220px;
            margin: 15px auto 0;
            padding: 10px;
            background-color: #dae2e4;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        #papeles-table-container {
            width: 480px;
            margin: 15px auto;
            padding: 8px;
            border: 1px solid #e0e6ed;
            border-radius: 3.5px;
            background-color: #f2f2f2;
            display: none; /* Inicialmente oculta */
        }

        #papeles-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        #papeles-table th,
        #papeles-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        #papeles-table th {
            background-color: #dae2e4;
        }
        .papel-cursiva {
            font-style: italic;
        }
        .papel-rojo {
            color: red;
        }
        .leyenda {
            font-size: 0.9em;
            margin-top: 12px;
            color: #333;
        }
    </style>
</head>

<body>
	<div class="logo-container">
        <a href="https://ruimanju.github.io/OOOTT_Acceso_Apps/">
            <img src="img/logo.png" alt="BOE - OO TT" class="logo">
        </a>
    </div>

    <h1>Calculadora de grosor de lomo</h1>

    <div class="calculator">
        <label for="papel">Selecciona el tipo de papel:</label>
        <select name="papel" id="papel"></select>

        <div class="custom-grosor-container" id="custom-grosor-container">
            <label for="grosor_personalizado">Grosor de hoja (mm):</label>
            <input type="number" id="grosor_personalizado" name="grosor_personalizado" min="0" step="0.001" placeholder="Ej: 0.125">
        </div>

        <label for="num_paginas">Número de páginas:</label>
        <input type="number" id="num_paginas" name="num_paginas" required>

        <button onclick="calcularGrosor()">Calcular grosor</button>

        <div id="result"></div>
        <div id="advertencia"></div>
    </div>

    <button id="toggle-table-btn">Mostrar catálogo</button>

    <div id="papeles-table-container">
        <h3>Catálogo de papeles y grosores</h3>
        <table id="papeles-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Grosor (mm)</th>
                    <th>págs<br>max/vol</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <p class="leyenda">En negro los papeles estándar, <span class="papel-cursiva">en cursiva</span> los que provisionalmente están sin stock y <span class="papel-rojo">en rojo</span> los de sustitución.</p>
    </div>
	
<script>
    // 1. Define aquí las referencias exactas de los papeles a estilizar
    const PAPELES_CURSIVA = [
        "Offset Superior Blanco 200 gr FSC/M"
    ];
    const PAPELES_ROJO_NEGRITA = [
        "Offset Superior Blanco 190 gr FSC/M",
        "Offset Superior Blanco 225 gr FSC/M"
    ];

    // Diccionario de grosores de papel
    const PAPEL_GROSORES = {
        "Semibiblia Blanco 50 gr FSC/M": 0.0552,
        "Semibiblia Blanco 60 gr FSC/M": 0.064,
        "Offset Superior Blanco 60 gr FSC/M": 0.0740,
        "Offset Superior Blanco 70 gr FSC/M": 0.0889,
        "Offset Superior Blanco 80 gr FSC/M": 0.1000,
        "Offset Superior Blanco 90 gr FSC/M": 0.1113,
        "Offset Superior Blanco 150 gr FSC/M": 0.1719,
        "Offset Superior Blanco 200 gr FSC/M": 0.2530,
        "Offset Superior Blanco 190 gr FSC/M": 0.2280,
        "Offset Superior Blanco 225 gr FSC/M": 0.2870,
        "Offset Ahuesado 80 gr FSC/M": 0.0952,
        "Offset Ahuesado 90 gr FSC/M": 0.1042,
        "Registro Ahuesado 140 gr FSC/M": 0.1510,
        "Estucado Semimate Blanco 90 gr FSC/M": 0.0773,
        "Estucado Semimate Blanco 135 gr FSC/M": 0.1160,
        "Estucado Semimate Blanco 170 gr FSC/M": 0.1460,
        "Estucado Semimate Blanco 300 gr FSC/M": 0.2780
    };

    // Diccionario de URLs de las fichas de material
    const PAPEL_URLS = {
        "Semibiblia Blanco 50 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2141",
        "Semibiblia Blanco 60 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=3095",
        "Offset Superior Blanco 60 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2548",
        "Offset Superior Blanco 70 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2250",
        "Offset Superior Blanco 80 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1864",
        "Offset Superior Blanco 90 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1816",
        "Offset Superior Blanco 150 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1990",
        "Offset Superior Blanco 200 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1775",
        "Offset Superior Blanco 190 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2184",
        "Offset Superior Blanco 225 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2924",
        "Offset Ahuesado 80 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2034",
        "Offset Ahuesado 90 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=2035",
        "Registro Ahuesado 140 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1012",
        "Estucado Semimate Blanco 90 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=3026",
        "Estucado Semimate Blanco 135 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=3036",
        "Estucado Semimate Blanco 170 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1843",
        "Estucado Semimate Blanco 300 gr FSC/M": "https://intraboe.boe.es/almacen/ficha_material.php?id_tipo_material=1797"
    };

    // Elementos del DOM
    const selectPapel = document.getElementById('papel');
    const numPaginasInput = document.getElementById('num_paginas');
    const customGrosorContainer = document.getElementById('custom-grosor-container');
    const customGrosorInput = document.getElementById('grosor_personalizado');
    const toggleTableBtn = document.getElementById('toggle-table-btn');
    const papelesTableContainer = document.getElementById('papeles-table-container');
    const papelesTableBody = document.querySelector('#papeles-table tbody');

    // Llena el menú desplegable con las opciones de papel
    function llenarSelect() {
        selectPapel.innerHTML = '';
        for (const papel in PAPEL_GROSORES) {
            const option = document.createElement('option');
            option.value = papel;
            option.text = papel;

            if (PAPELES_CURSIVA.includes(papel)) {
                option.classList.add('papel-cursiva');
            }
            if (PAPELES_ROJO_NEGRITA.includes(papel)) {
                option.classList.add('papel-rojo');
            }
            selectPapel.add(option);
        }
        // --- AÑADE LA OPCIÓN "OTRO" ---
        const otroOption = document.createElement('option');
        otroOption.value = 'otro';
        otroOption.text = 'Otro...';
        selectPapel.add(otroOption);
    }

    // Redondea al alza al medio milímetro más cercano
    function redondearAlza(numero) {
        return Math.ceil(numero * 2) / 2;
    }

    // Función principal para calcular el grosor del lomo
    function calcularGrosor() {
        const papelSeleccionado = selectPapel.value;
        const numPaginas = parseInt(numPaginasInput.value, 10);
        let grosorHoja = 0;
        
        // --- LÓGICA MODIFICADA PARA CALCULAR ---
        if (papelSeleccionado === 'otro') {
            grosorHoja = parseFloat(customGrosorInput.value);
        } else {
            grosorHoja = PAPEL_GROSORES[papelSeleccionado];
        }

        let resultado = 0;
        let advertencia = "";

        if (grosorHoja > 0 && numPaginas > 0) {
            const numHojas = numPaginas / 2;
            resultado = numHojas * grosorHoja;
            resultado = redondearAlza(resultado);

            if (resultado > 50) {
                advertencia = "<p class='advertencia'>Este volumen excede el límite máximo de grosor en encuadernación</p>";
            }

            document.getElementById('result').textContent = `El grosor del lomo es: ${resultado} mm`;
            document.getElementById('advertencia').innerHTML = advertencia;
        } else {
            document.getElementById('result').textContent = "Por favor, completa todos los campos requeridos.";
            document.getElementById('advertencia').innerHTML = "";
        }
    }

    // Genera y llena la tabla del catálogo
    function generarTablaPapeles() {
        const MAX_PAGINAS = {
            "Offset Superior Blanco 70 gr FSC/M": 1130,
            "Offset Superior Blanco 80 gr FSC/M": 1010,
            "Offset Superior Blanco 90 gr FSC/M": 910
        };

        papelesTableBody.innerHTML = ''; // Limpiar la tabla
        for (const papel in PAPEL_GROSORES) {
            const row = document.createElement('tr');
            const nombreCell = document.createElement('td');
            const grosorCell = document.createElement('td');
            const maxPagCell = document.createElement('td');
            
            const url = PAPEL_URLS[papel];
            if (url) {
                const link = document.createElement('a');
                link.href = url;
                link.textContent = papel;
                link.target = "_blank"; // Abre el enlace en una nueva pestaña
                
                // --- MODIFICACIÓN PARA COLOREAR EL ENLACE ---
                if (PAPELES_ROJO_NEGRITA.includes(papel)) {
                    link.style.color = 'red';
                }
                
                nombreCell.appendChild(link);
            } else {
                nombreCell.textContent = papel;
            }

            grosorCell.textContent = PAPEL_GROSORES[papel];
            maxPagCell.textContent = MAX_PAGINAS[papel] || '';

            if (PAPELES_CURSIVA.includes(papel)) {
                nombreCell.classList.add('papel-cursiva');
            }
            if (PAPELES_ROJO_NEGRITA.includes(papel)) {
                // Se aplica la clase a la celda por si no tuviera enlace
                nombreCell.classList.add('papel-rojo');
            }
            row.appendChild(nombreCell);
            row.appendChild(grosorCell);
            row.appendChild(maxPagCell);
            papelesTableBody.appendChild(row);
        }
    }
    
    // --- EVENTO PARA MOSTRAR/OCULTAR EL CAMPO PERSONALIZADO ---
    selectPapel.addEventListener('change', function() {
        if (selectPapel.value === 'otro') {
            customGrosorContainer.style.display = 'block';
        } else {
            customGrosorContainer.style.display = 'none';
        }
    });

    // Event listener para el botón de mostrar/ocultar tabla
    toggleTableBtn.addEventListener('click', function() {
        if (papelesTableContainer.style.display === 'none' || papelesTableContainer.style.display === '') {
            generarTablaPapeles();
            papelesTableContainer.style.display = 'block';
            toggleTableBtn.textContent = 'Ocultar catálogo';
        } else {
            papelesTableContainer.style.display = 'none';
            toggleTableBtn.textContent = 'Mostrar catálogo';
        }
    });

    // Event listener para el botón Enter en el campo de páginas
    numPaginasInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            calcularGrosor();
        }
    });

    // Llama a la función para llenar el select al cargar la página
    llenarSelect();
</script>
</body>
</html>
