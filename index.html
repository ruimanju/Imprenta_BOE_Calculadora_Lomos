<!DOCTYPE html>
<html lang="es">

<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Calculadora de grosor de lomo</title>
		<style>
	 	 	 	 body {
	 	 	 	 	 	 font-family: sans-serif;
	 	 	 	 	 	 margin: 14px;
	 	 	 	 	 	 font-size: 1em; /* Tamaño de fuente principal para todos los elementos */
	 	 	 	 }

	 	 	 	 h1 {
	 	 	 	 	 	 text-align: center;
	 	 	 	 	 	 font-size: 1.35em; /* Mantenemos este tamaño, pero lo ajusto para que sea relativo al body */
	 	 	 	 }

	 	 	 	 .calculator {
	 	 	 	 	 	 width: 340px;
	 	 	 	 	 	 margin: 0 auto;
	 	 	 	 	 	 border: 1px solid #ccc;
	 	 	 	 	 	 padding: 15px;
	 	 	 	 	 	 border-radius: 3.5px;
	 	 	 	 }

	 	 	 	 label {
	 	 	 	 	 	 display: block;
	 	 	 	 	 	 margin-bottom: 5px;
	 	 	 	 }

	 	 	 	 select,
	 	 	 	 input {
	 	 	 	 	 	 width: 100%;
	 	 	 	 	 	 padding: 8px;
	 	 	 	 	 	 margin-bottom: 10px;
	 	 	 	 	 	 box-sizing: border-box;
						 font-size: 0.9em; /* Ajuste específico para campos y selectores */
	 	 	 	 }

	 	 	 	 button {
	 	 	 	 	 	 width: 100%;
	 	 	 	 	 	 padding: 7px;
	 	 	 	 	 	 background-color: #007BFF;
	 	 	 	 	 	 color: white;
	 	 	 	 	 	 border: none;
	 	 	 	 	 	 border-radius: 3.5px;
	 	 	 	 	 	 cursor: pointer;
	 	 	 	 	 	 margin-top: 3.5px;
						 font-weight: bold;
						 font-size: 1em; /* Ajuste específico para campos y selectores */
	 	 	 	 }

	 	 	 	 button:hover {
	 	 	 	 	 	 background-color: #0056b3;
	 	 	 	 }

	 	 	 	 #result {
	 	 	 	 	 	 margin-top: 7px;
	 	 	 	 	 	 font-weight: bold;
	 	 	 	 }

	 	 	 	 .logo-container {
	 	 	 	 	 	 display: flex;
	 	 	 	 	 	 justify-content: center;
	 	 	 	 	 	 margin-bottom: 14px;
	 	 	 	 }

	 	 	 	 .logo {
	 	 	 	 	 	 max-width: 480px;
	 	 	 	 	 	 height: auto;
	 	 	 	 }

	 	 	 	 .advertencia {
	 	 	 	 	 	 color: red;
	 	 	 	 	 	 font-weight: bold;
	 	 	 	 }

				#papeles-table-container {
    					font-size: 0.8em;
				}

				#papeles-table {
   						width: 100%;
    					border-collapse: collapse; /* Esto asegura que los bordes se unan y no haya doble borde */
				}

				#papeles-table th,
				#papeles-table td {
    					border: 0.8px solid #ccc; /* Aplica un borde fino de color gris */
    					padding: 8px; /* Añade un poco de espacio alrededor del texto en cada celda */
    					text-align: left;
				}

				#papeles-table th {
    					background-color: #f2f2f2; /* Opcional: un fondo ligeramente diferente para la cabecera */
				}

	 	 	 	 .footer {
	 	 	 	 	 	 text-align: center;
	 	 	 	 	 	 margin-top: 28px;
	 	 	 	 	 	 padding-top: 14px;
	 	 	 	 	 	 border-top: 1px solid #e0e6ed;
	 	 	 	 	 	 color: #7f8c8d;
	 	 	 	 	 	 font-size: 0.85em; /* Reducido para que sea más pequeño que el resto */
	 	 	 	 }

	 	 	 	 #toggle-editor {
						display: block;
						width: 220px;
						text-align: center;
						margin: 15px auto 0; /* Centrado y con margen superior */
						font-size: 0.9em; /* Para que sea más pequeño que el resto */
						color: #007BFF;
						text-decoration: underline;
						cursor: pointer;
				}

	 	 	 	 #toggle-editor:hover {
	 	 	 	 	 	 color: #0056b3;
	 	 	 	 }

	 	 	 	 .editor-container {
					width: 340px; /* Anchura fija */
					margin: 15px auto 0; /* Centrado y con margen superior */
					padding: 15px;
					border: 1px solid #e0e6ed;
					border-radius: 3.5px;
					background-color: #f5f5f5;
					display: none;
					box-sizing: border-box;
					font-size: 0.9em;
				}

	 	 	 	 .editor-container h2 {
	 	 	 	 	 	 margin: 0 0 7px 0;
	 	 	 	 	 	 font-size: 1.1em; /* Ajuste para que sea ligeramente más grande que el texto del editor */
	 	 	 	 	 	 text-align: center;
	 	 	 	 	 	 color: #555;
	 	 	 	 }

	 	 	 	 .editor-container label {
	 	 	 	 	 	 color: #555;
	 	 	 	 }

	 	 	 	 .editor-container button {
	 	 	 	 	 	 background-color: #28a745;
	 	 	 	 	 	 padding: 5.6px;
	 	 	 	 }

	 	 	 	 .editor-container button:hover {
	 	 	 	 	 	 background-color: #218838;
	 	 	 	 }

	 	 	 	 #delete-btn {
	 	 	 	 	 	 background-color: #dc3545;
	 	 	 	 }

	 	 	 	 #delete-btn:hover {
	 	 	 	 	 	 background-color: #c82333;
	 	 	 	 }
	 	 </style>
</head>

<body>

	 	 <div class="logo-container">
	 	 	 	 <img src="img/logo.png" alt="BOE - OO TT" class="logo">
	 	 </div>

	 	 <h1>Calculadora de grosor de lomo</h1>

	 	 <div class="calculator">
	 	 	 	 <label for="papel">Selecciona el tipo de papel:</label>
	 	 	 	 <select name="papel" id="papel"></select>

	 	 	 	 <label for="num_paginas">Número de páginas:</label>
	 	 	 	 <input type="number" id="num_paginas" name="num_paginas" required>

	 	 	 	 <button onclick="calcularGrosor()">Calcular grosor</button>

	 	 	 	 <div id="result"></div>
	 	 	 	 <div id="advertencia"></div>
			 
	 	 </div>
			<button id="toggle-table-btn" style="width: 220px; margin: 15px auto 0; display: block;">Mostrar catálogo</button>
			<div id="papeles-table-container" style="display: none; width: 480px; margin: 12px auto; padding: 12px; border: 1px solid #e0e6ed; border-radius: 3.5px; background-color: #f5f5f5;">
    			<h3>Catálogo de Papeles y Grosores</h3>
    			<table id="papeles-table" style="width: 100%; border-collapse: collapse;">
        			<thead>
            			<tr>
                			<th style="border: 1px solid #ccc; padding: 8px; font-size: 0.9em; text-align: left;">Nombre</th>
                			<th style="border: 1px solid #ccc; padding: 8px; font-size: 0.9em; text-align: left;">Grosor (mm)</th>
            			</tr>
        			</thead>
        			<tbody>
            			</tbody>
    			</table>
			</div>
	
		<a href="#" id="toggle-editor">Gestionar papeles</a>
		<div class="editor-container" id="editor-form">
		    <h2>Gestión de Papeles</h2>
    		<div id="password-form">
        		<label for="password-input">Introduce la contraseña:</label>
        		<input type="password" id="password-input">
        		<button id="access-btn">Acceder</button>
    		</div>
    		<div id="editor-content" style="display: none;">
        		<label for="edit-papel-select">Seleccionar papel para editar/eliminar:</label>
        		<select name="edit-papel-select" id="edit-papel-select"></select>
        		<label for="nuevo-papel-nombre">Nombre del papel:</label>
        		<input type="text" id="nuevo-papel-nombre" placeholder="Nombre">
        		<label for="nuevo-papel-grosor">Grosor (mm):</label>
        		<input type="number" id="nuevo-papel-grosor" step="0.0001" placeholder="Grosor en mm">
        		<button onclick="guardarPapel()">Añadir / Editar</button>
        		<button id="delete-btn" onclick="eliminarPapel()">Eliminar</button>
    		</div>
		</div>

<script>
    const LOCAL_STORAGE_KEY = 'papelGrosoresLocales';

    let PAPEL_GROSORES = {};
    const selectPapel = document.getElementById('papel');
    const editSelectPapel = document.getElementById('edit-papel-select');
    const editorForm = document.getElementById('editor-form');
    const toggleEditorBtn = document.getElementById('toggle-editor');
    const nuevoPapelNombre = document.getElementById('nuevo-papel-nombre');
    const nuevoPapelGrosor = document.getElementById('nuevo-papel-grosor');
    const saveButton = document.querySelector('.editor-container button:not(#delete-btn)');
	const toggleTableBtn = document.getElementById('toggle-table-btn');
	const papelesTableContainer = document.getElementById('papeles-table-container');
	const papelesTableBody = document.querySelector('#papeles-table tbody');
	const passwordInput = document.getElementById('password-input');
	const accessBtn = document.getElementById('access-btn');
	passwordInput.addEventListener('keypress', function(event) {
    	if (event.key === 'Enter') {
        	accessBtn.click();
    	}
	});
	const editorContent = document.getElementById('editor-content');
	const passwordForm = document.getElementById('password-form');
	const CORRECT_PASSWORD = "OOTT2025;"; // ¡Aquí definimos la contraseña!

    // Función para cargar los datos del archivo y del localStorage
    async function cargarPapeles() {
        try {
            // 1. Cargar datos del archivo JSON
            const response = await fetch('papeles.json');
            if (!response.ok) {
                throw new Error('No se pudo cargar el archivo de papeles.');
            }
            const data = await response.json();
            const papelesBase = data.papeles;

            // 2. Cargar datos de localStorage (si existen)
            const papelesLocales = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY));

            // 3. Unir los datos: los locales sobrescriben a los del archivo
            PAPEL_GROSORES = { ...papelesBase, ...papelesLocales };
            
            llenarSelects();
        } catch (error) {
            console.error("Error al cargar los papeles:", error);
            alert("No se pudo cargar la lista de papeles. Usando datos por defecto.");
            // Usar datos por defecto si falla la carga
            PAPEL_GROSORES = {
                "Semibiblia Blanco 50 gr FSC/M": 0.0552,
                "Semibiblia Blanco 60 gr FSC/M": 0.064,
                "Offset Superior Blanco 60 gr FSC/M": 0.0740,
                "Offset Superior Blanco 70 gr FSC/M": 0.0889,
                "Offset Superior Blanco 80 gr FSC/M": 0.1000,
                "Offset Superior Blanco 90 gr FSC/M": 0.1113,
                "Offset Superior Blanco 150 gr FSC/M": 0.1719,
                "Offset Superior Blanco 200 gr FSC/M": 0.2530,
                "Offset Ahuesado 80 gr FSC/M": 0.0952,
                "Offset Ahuesado 90 gr FSC/M": 0.1042,
                "Registro Ahuesado 140 gr FSC/M": 0.1510,
                "Estucado Semimate Blanco 90 gr FSC/M": 0.0773,
                "Estucado Semimate Blanco 135 gr FSC/M": 0.1160,
                "Estucado Semimate Blanco 170 gr FSC/M": 0.1460,
                "Estucado Semimate Blanco 300 gr FSC/M": 0.2780
            };
            llenarSelects();
        }
    }

    function llenarSelects() {
        selectPapel.innerHTML = '';
        editSelectPapel.innerHTML = '';
        for (const papel in PAPEL_GROSORES) {
            const option = document.createElement('option');
            option.value = papel;
            option.text = papel;
            selectPapel.add(option);
            const editOption = document.createElement('option');
            editOption.value = papel;
            editOption.text = papel;
            editSelectPapel.add(editOption);
        }
    }

    function guardarDatos() {
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(PAPEL_GROSORES));
    }

    function redondearAlza(numero) {
        return Math.ceil(numero * 2) / 2;
    }

    function calcularGrosor() {
        const papelSeleccionado = selectPapel.value;
        const numPaginas = parseInt(document.getElementById('num_paginas').value, 10);
        const grosorHoja = PAPEL_GROSORES[papelSeleccionado];
        let resultado = 0;
        let advertencia = "";

        if (grosorHoja && numPaginas > 0) {
            const numHojas = numPaginas / 2;
            resultado = numHojas * grosorHoja;
            resultado = redondearAlza(resultado);

            if (resultado > 49) {
                advertencia = "<p class='advertencia'>Este volumen excede el límite máximo de grosor en encuadernación</p>";
            }

            document.getElementById('result').textContent = `El grosor del lomo es: ${resultado} mm`;
            document.getElementById('advertencia').innerHTML = advertencia;
        } else {
            document.getElementById('result').textContent = "Por favor, selecciona el papel e introduce un número de páginas válido.";
            document.getElementById('advertencia').innerHTML = "";
        }
    }

    function guardarPapel() {
        const nombre = nuevoPapelNombre.value.trim();
        const grosor = parseFloat(nuevoPapelGrosor.value);
        const papelSeleccionado = editSelectPapel.value;

        if (!nombre) {
            alert("Por favor, introduce un nombre para el papel.");
            return;
        }

        if (isNaN(grosor) || grosor <= 0) {
            alert("Por favor, introduce un grosor válido y mayor que cero.");
            return;
        }

        if (nombre === papelSeleccionado && PAPEL_GROSORES.hasOwnProperty(papelSeleccionado)) {
            PAPEL_GROSORES[nombre] = grosor;
            alert(`Papel "${nombre}" actualizado.`);
        } else {
            if (PAPEL_GROSORES.hasOwnProperty(nombre)) {
                if (!confirm(`El papel "${nombre}" ya existe. ¿Deseas sobrescribirlo?`)) {
                    return;
                }
            }
            if (nombre !== papelSeleccionado && PAPEL_GROSORES.hasOwnProperty(papelSeleccionado)) {
                delete PAPEL_GROSORES[papelSeleccionado];
            }
            PAPEL_GROSORES[nombre] = grosor;
            alert(`Papel "${nombre}" añadido / editado.`);
        }

        guardarDatos();
        llenarSelects();
        nuevoPapelNombre.value = '';
        nuevoPapelGrosor.value = '';
    }

    function eliminarPapel() {
        const papelAEliminar = editSelectPapel.value;
        if (papelAEliminar) {
            if (confirm(`¿Estás seguro de que quieres eliminar "${papelAEliminar}"?`)) {
                delete PAPEL_GROSORES[papelAEliminar];
                guardarDatos();
                llenarSelects();
                alert(`Papel "${papelAEliminar}" eliminado.`);
                nuevoPapelNombre.value = '';
                nuevoPapelGrosor.value = '';
            }
        } else {
            alert("Selecciona un papel para eliminar.");
        }
    }

    editSelectPapel.addEventListener('change', function() {
        const papelSeleccionado = this.value;
        const grosor = PAPEL_GROSORES[papelSeleccionado];
        nuevoPapelNombre.value = papelSeleccionado;
        nuevoPapelGrosor.value = grosor;
        saveButton.textContent = 'Editar';
    });
    
    nuevoPapelNombre.addEventListener('input', function() {
        if (this.value.trim() !== editSelectPapel.value.trim()) {
            saveButton.textContent = 'Añadir';
        } else {
            saveButton.textContent = 'Editar';
        }
    });

    document.getElementById('num_paginas').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            calcularGrosor();
        }
    });

   // Nuevo listener para el enlace de "Gestionar papeles"
	toggleEditorBtn.addEventListener('click', function(event) {
    	event.preventDefault();
    	if (editorForm.style.display === 'none' || editorForm.style.display === '') {
        	editorForm.style.display = 'block';
        	toggleEditorBtn.textContent = 'Ocultar gestión';
    	} else {
        	editorForm.style.display = 'none';
        	passwordForm.style.display = 'block';
        	editorContent.style.display = 'none';
        	toggleEditorBtn.textContent = 'Gestionar papeles';
    	}
	});

	// Nuevo listener para el botón de "Acceder"
	accessBtn.addEventListener('click', function() {
  		if (passwordInput.value === CORRECT_PASSWORD) {
        	passwordForm.style.display = 'none';
        	editorContent.style.display = 'block';
        	passwordInput.value = ''; // Limpiar el campo de contraseña por seguridad
    	} else {
        	alert('Contraseña incorrecta.');
    	}
	});

	function generarTablaPapeles() {
    papelesTableBody.innerHTML = ''; // Limpiar la tabla
    for (const papel in PAPEL_GROSORES) {
        const row = document.createElement('tr');
        const nombreCell = document.createElement('td');
        const grosorCell = document.createElement('td');

        nombreCell.textContent = papel;
        grosorCell.textContent = PAPEL_GROSORES[papel];

        row.appendChild(nombreCell);
        row.appendChild(grosorCell);
        papelesTableBody.appendChild(row);
    }
}

toggleTableBtn.addEventListener('click', function() {
    if (papelesTableContainer.style.display === 'none' || papelesTableContainer.style.display === '') {
        generarTablaPapeles();
        papelesTableContainer.style.display = 'block';
        toggleTableBtn.textContent = 'Ocultar catálogo';
    } else {
        papelesTableContainer.style.display = 'none';
        toggleTableBtn.textContent = 'Mostrar catálogo';
    }
});
	
    cargarPapeles();
</script>

	 	 <div class="footer">
	 	 	 	 <p>Herramienta para cálculo del lomo de las publicaciones | BOE - OO TT</p>
	 	 	 	 <p>© 2025 Todos los derechos reservados</p>
	 	 </div>
</body>


</html>











